<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ - Links</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="stats-container">
        <div class="stats-header">
            <h1>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–∫–æ–≤</h1>
            <a href="/">‚Üê –ù–∞–∑–∞–¥ –∫ —Å—Å—ã–ª–∫–∞–º</a>
        </div>

        <!-- Total Clicks -->
        <div class="stats-card">
            <h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            <div class="stat-item">
                <span class="stat-label">–í—Å–µ–≥–æ –∫–ª–∏–∫–æ–≤:</span>
                <span class="stat-value" id="totalClicks">0</span>
            </div>
        </div>

        <!-- Clicks by Link -->
        <div class="stats-card">
            <h2>–ö–ª–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–∞–º</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>–°—Å—ã–ª–∫–∞</th>
                        <th>–ö–ª–∏–∫–æ–≤</th>
                        <th>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Å–µ—Ç–∏—Ç–µ–ª–µ–π</th>
                    </tr>
                </thead>
                <tbody id="clicksByLink">
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Recent Clicks -->
        <div class="stats-card">
            <h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª–∏–∫–∏ (50)</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>–í—Ä–µ–º—è</th>
                        <th>–°—Å—ã–ª–∫–∞</th>
                        <th>IP –∞–¥—Ä–µ—Å</th>
                    </tr>
                </thead>
                <tbody id="recentClicks">
                    <tr>
                        <td colspan="3" style="text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Clicks by Day -->
        <div class="stats-card">
            <h2>–ö–ª–∏–∫–∏ –ø–æ –¥–Ω—è–º (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 30 –¥–Ω–µ–π)</h2>
            <table class="stats-table">
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ö–ª–∏–∫–æ–≤</th>
                    </tr>
                </thead>
                <tbody id="clicksByDay">
                    <tr>
                        <td colspan="2" style="text-align: center; padding: 20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const data = await response.json();

                // Total clicks
                document.getElementById('totalClicks').textContent = data.totalClicks || 0;

                // Clicks by link
                const clicksByLinkTbody = document.getElementById('clicksByLink');
                if (data.clicksByLink && data.clicksByLink.length > 0) {
                    clicksByLinkTbody.innerHTML = data.clicksByLink.map(item => `
                        <tr>
                            <td class="link-url" title="${item.link_url}">${item.link_text || item.link_url}</td>
                            <td>${item.clicks}</td>
                            <td>${item.unique_visitors}</td>
                        </tr>
                    `).join('');
                } else {
                    clicksByLinkTbody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                }

                // Recent clicks
                const recentClicksTbody = document.getElementById('recentClicks');
                if (data.recentClicks && data.recentClicks.length > 0) {
                    recentClicksTbody.innerHTML = data.recentClicks.map(item => {
                        const date = new Date(item.clicked_at);
                        const formattedDate = date.toLocaleString('ru-RU', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        return `
                            <tr>
                                <td class="date">${formattedDate}</td>
                                <td class="link-url" title="${item.link_url}">${item.link_text || item.link_url}</td>
                                <td class="ip-address">${item.ip_address}</td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    recentClicksTbody.innerHTML = '<tr><td colspan="3" style="text-align: center; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                }

                // Clicks by day
                const clicksByDayTbody = document.getElementById('clicksByDay');
                if (data.clicksByDay && data.clicksByDay.length > 0) {
                    clicksByDayTbody.innerHTML = data.clicksByDay.map(item => {
                        const date = new Date(item.date);
                        const formattedDate = date.toLocaleDateString('ru-RU', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit'
                        });
                        return `
                            <tr>
                                <td>${formattedDate}</td>
                                <td>${item.clicks}</td>
                            </tr>
                        `;
                    }).join('');
                } else {
                    clicksByDayTbody.innerHTML = '<tr><td colspan="2" style="text-align: center; padding: 20px;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</td></tr>';
                }

            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('totalClicks').textContent = '–û—à–∏–±–∫–∞';
            }
        }

        // Load stats on page load
        loadStats();

        // Auto-refresh every 30 seconds
        setInterval(loadStats, 30000);
    </script>
</body>
</html>
